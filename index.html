<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Harringtons Reselling</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{--bg:#ffffff;--bg-soft:#fff7f9;--accent:#ffccd6;--accent-2:#ffd9e0;--text:#222;--muted:#666;--radius:18px;--shadow:0 8px 24px rgba(255,160,180,0.25)}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,sans-serif;background:linear-gradient(180deg,var(--bg),var(--bg-soft));color:var(--text)}
header{position:sticky;top:0;display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:rgba(255,255,255,0.8);border-bottom:1px solid var(--accent-2);backdrop-filter:saturate(1.2) blur(8px)}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:40px;height:40px;border-radius:50%;background:radial-gradient(circle at 30% 30%,var(--accent),var(--accent-2));box-shadow:var(--shadow)}
h1{margin:0;font-size:1.4rem}
.btn{border:none;border-radius:14px;padding:10px 14px;font-weight:600;cursor:pointer;box-shadow:var(--shadow);background:var(--accent)}
.btn:hover{filter:brightness(0.98)}
.btn.secondary{background:#fff;border:1px solid var(--accent-2)}
.btn.danger{background:#ffe5e9;color:#aa0f2c;border:1px solid #ffd1db}
main{max-width:1100px;margin:20px auto;padding:0 18px 80px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
.card{background:white;border:1px solid var(--accent-2);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;display:flex;flex-direction:column;gap:10px;text-align:center}
.card img{width:100%;height:180px;object-fit:cover;border-radius:12px;background:var(--bg-soft);border:1px dashed var(--accent-2)}
.price{font-weight:800;margin-top:auto}
.muted{color:var(--muted)}
.modalContainer{position:fixed;top:0;left:0;width:100%;height:100%;display:none;justify-content:center;align-items:center;background:rgba(0,0,0,0.6)}
.modal{background:white;padding:30px;border-radius:var(--radius);box-shadow:var(--shadow);width:300px;text-align:center}
.dashboard{display:none;padding:20px}
.dashboard input,.dashboard select{width:100%;padding:8px;margin:8px 0;border-radius:8px;border:1px solid var(--accent-2)}
footer{background:var(--bg-soft);border-top:1px solid var(--accent-2);padding:20px;text-align:center;margin-top:40px}
.actions button{margin:2px}
.logoutBtn{margin-top:12px;background:#ccc;color:#333}
</style>
</head>
<body>

<header>
<div class="brand"><div class="logo"></div><h1>Harringtons Reselling</h1></div>
<div>
<button class="btn" id="ownerLoginBtn">Owner Log In</button>
<button class="btn" id="userLoginBtn">User Log In</button>
<button class="btn" id="businessInfoBtn" style="display:none">Business Info</button>
</div>
</header>

<main id="mainContent">
<section id="welcomeSection">
<h2>Welcome to Harringtons Reselling</h2>
<p class="muted">Striving to start a business of my own, selling Lego at a semi cheap price and also other stuff! stay tuned</p>
</section>

<section id="productsSection">
<h2 style="margin:18px 0 8px">Our Products</h2>
<div id="productsGrid" class="grid"></div>
</section>

<section id="ownerDashboard" class="dashboard">
<h2>Owner Dashboard</h2>
<p>Manage products and user accounts.</p>
<h3>Add Product</h3>
<input id="ownerProductTitle" placeholder="Title">
<input id="ownerProductPrice" type="number" placeholder="Price">
<input id="ownerProductDesc" placeholder="Description">
<input id="ownerProductImg" placeholder="Image URL">
<button class="btn" id="addProductBtn">Add Product</button>

<h3>Existing Products</h3>
<div id="ownerProductList" class="grid"></div>

<h3>Manage Users</h3>
<input id="newUserId" placeholder="New User ID">
<select id="newUserPerm">
<option value="add">Add Products</option>
<option value="remove">Remove Products</option>
<option value="both">Add & Remove Products</option>
</select>
<button class="btn" id="addUserBtn">Add User</button>
<div id="userList"></div>

<h4>Remove Users</h4>
<input id="removeUserId" placeholder="User ID to Remove">
<button class="btn danger" id="removeUserBtn">Remove User</button>
<button class="btn logoutBtn" id="ownerLogoutBtn">Log Out</button>
</section>

<section id="userDashboard" class="dashboard">
<h2>User Dashboard</h2>
<p>Welcome! Your user-specific dashboard appears here.</p>
<div id="userActions"></div>
<button class="btn logoutBtn" id="userLogoutBtn">Log Out</button>
</section>

<section id="businessInfoSection" class="dashboard">
<h2>Business Information (Updating every Sunday around 12 pm)</h2>
<p>Selling Rare Lego (May also sell some PC stuff)</p>
<p>Looking to find reputable sources, Camberwell market, garage sales etc, $120 available to spend. Hoping it will take 3 weeks to finalise the business and get it running.</p>
<button class="btn logoutBtn" id="infoBackBtn">Back</button>
</section>
</main>

<footer>
<h3>Looking to buy</h3>
<p>Email: hwhaley585@gmail.com</p>
<p>Phone: 0452587072</p>
<p>&copy; 2025 Harringtons Reselling.</p>
</footer>

<div id="loginModal" class="modalContainer">
<div class="modal">
<h3>Owner Login</h3>
<input id="ownerIdInput" placeholder="Enter Owner ID" style="width:100%; padding:8px; margin:12px 0">
<button class="btn" id="ownerSubmitBtn">Log In</button>
<button class="btn secondary" id="ownerCancelBtn">Cancel</button>
</div>
</div>

<div id="userLoginModal" class="modalContainer">
<div class="modal">
<h3>User login</h3>
<input id="userIdInput" placeholder="Enter User ID" style="width:100%; padding:8px; margin:12px 0">
<button class="btn" id="userSubmitBtn">Log In</button>
<button class="btn secondary" id="userCancelBtn">Cancel</button>
</div>
</div>

<script>
// --- Firebase config ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- Current user ---
const OWNER_ID = '4811042012';
let currentUserRole = null; // 'owner' or 'user'

// --- DATABASE FUNCTIONS ---
async function loadProducts(){
  const snapshot = await db.ref('products').get();
  return snapshot.exists() ? snapshot.val() : {};
}
async function saveProduct(product){
  const newRef = db.ref('products').push();
  await newRef.set(product);
}
async function removeProduct(key){
  await db.ref('products/' + key).remove();
}

async function loadUsers(){
  const snapshot = await db.ref('users').get();
  return snapshot.exists() ? snapshot.val() : {};
}
async function saveUser(id, perm){
  await db.ref('users/' + id).set({perm});
}
async function removeUser(id){
  await db.ref('users/' + id).remove();
}

// --- RENDER FUNCTIONS ---
async function renderProducts(){
  const products = await loadProducts();
  const grid = document.getElementById('productsGrid'); grid.innerHTML='';
  if(!products || Object.keys(products).length===0){grid.innerHTML='<div class="card">No products yet.</div>'; return}
  for(const key in products){
    const p = products[key];
    const c = document.createElement('div'); c.className='card';
    c.innerHTML=`<img src="${p.img||''}" alt="${p.title}" onerror="this.style.display='none'">
      <div><strong>${p.title}</strong></div>
      <div class="price">$${p.price.toFixed(2)}</div>
      <div class="muted">${p.desc||''}</div>`;
    grid.appendChild(c)
  }
}

async function renderOwnerProductList(){
  const products = await loadProducts();
  const list = document.getElementById('ownerProductList'); list.innerHTML='';
  if(!products || Object.keys(products).length===0){list.innerHTML='<div class="card">No products yet.</div>'; return}
  for(const key in products){
    const p = products[key];
    const c = document.createElement('div'); c.className='card';
    c.innerHTML=`<div><strong>${p.title}</strong></div>
      <div class="price">$${p.price.toFixed(2)}</div>
      <div class="muted">${p.desc||''}</div>
      <div class="actions"><button class="btn danger" data-key='${key}'>Remove</button></div>`;
    list.appendChild(c);
  }
  list.querySelectorAll('.btn.danger').forEach(btn=>{
    btn.addEventListener('click', async function(){
      const key = this.dataset.key;
      await removeProduct(key);
      await renderProducts(); await renderOwnerProductList();
    });
  });
}

async function renderUsers(){
  const users = await loadUsers();
  const userListDiv = document.getElementById('userList'); userListDiv.innerHTML='';
  for(const id in users){
    const div=document.createElement('div');
    div.textContent=`ID: ${id}, Permission: ${users[id]?.perm || 'none'}`;
    userListDiv.appendChild(div);
  }
}

async function renderUserActions(user){
  if(!user || !user.perm) return;
  const userActions = document.getElementById('userActions'); userActions.innerHTML='';

  if(user.perm.includes('add')){
    userActions.innerHTML += `<h3>Add Product</h3>
      <input id='userProductTitle' placeholder='Title'>
      <input id='userProductPrice' type='number' placeholder='Price'>
      <input id='userProductDesc' placeholder='Description'>
      <input id='userProductImg' placeholder='Image URL'>
      <button class='btn' id='userAddProductBtn'>Add Product</button>`;
    document.getElementById('userAddProductBtn').addEventListener('click', async ()=>{
      const title = document.getElementById('userProductTitle').value;
      const price = parseFloat(document.getElementById('userProductPrice').value);
      const desc = document.getElementById('userProductDesc').value;
      const img = document.getElementById('userProductImg').value;
      await saveProduct({title,price,desc,img});
      await renderProducts(); await renderOwnerProductList(); await renderUserActions(user);
    });
  }

  if(user.perm.includes('remove')){
    userActions.innerHTML += `<h3>Remove Products</h3><div id='userRemoveList' class='grid'></div>`;
    const products = await loadProducts(); const removeList = document.getElementById('userRemoveList');
    for(const key in products){
      const p = products[key];
      const c = document.createElement('div'); c.className='card';
      c.innerHTML=`<div><strong>${p.title}</strong></div>
        <div class='price'>$${p.price.toFixed(2)}</div>
        <div class='muted'>${p.desc||''}</div>
        <div class='actions'><button class='btn danger' data-key='${key}'>Remove</button></div>`;
      removeList.appendChild(c);
    }
    removeList.querySelectorAll('.btn.danger').forEach(btn=>{
      btn.addEventListener('click', async function(){
        const key = this.dataset.key;
        await removeProduct(key);
        await renderProducts(); await renderOwnerProductList(); await renderUserActions(user);
      });
    });
  }
}

// --- LOGIN / LOGOUT ---
const ownerLoginBtn = document.getElementById('ownerLoginBtn');
const userLoginBtn = document.getElementById('userLoginBtn');
const businessInfoBtn = document.getElementById('businessInfoBtn');
const ownerCancelBtn = document.getElementById('ownerCancelBtn');
const userCancelBtn = document.getElementById('userCancelBtn');
const ownerSubmitBtn = document.getElementById('ownerSubmitBtn');
const userSubmitBtn = document.getElementById('userSubmitBtn');
const loginModal = document.getElementById('loginModal');
const userLoginModal = document.getElementById('userLoginModal');
const welcomeSection = document.getElementById('welcomeSection');
const productsSection = document.getElementById('productsSection');
const ownerDashboard = document.getElementById('ownerDashboard');
const userDashboard = document.getElementById('userDashboard');
const businessInfoSection = document.getElementById('businessInfoSection');
const ownerLogoutBtn = document.getElementById('ownerLogoutBtn');
const userLogoutBtn = document.getElementById('userLogoutBtn');
const infoBackBtn = document.getElementById('infoBackBtn');

function openLogin(){loginModal.style.display='flex'}
function closeLogin(){loginModal.style.display='none'}
function openUserLogin(){userLoginModal.style.display='flex'}
function closeUserLogin(){userLoginModal.style.display='none'}

function logout(){
  currentUserRole=null;
  welcomeSection.style.display='block';
  productsSection.style.display='block';
  ownerDashboard.style.display='none';
  userDashboard.style.display='none';
  businessInfoSection.style.display='none';
  businessInfoBtn.style.display='none';
}

ownerLoginBtn.addEventListener('click', openLogin);
userLoginBtn.addEventListener('click', openUserLogin);
ownerCancelBtn.addEventListener('click', closeLogin);
userCancelBtn.addEventListener('click', closeUserLogin);

ownerSubmitBtn.addEventListener('click', ()=>{
  const val = document.getElementById('ownerIdInput').value;
  if(val===OWNER_ID){
    currentUserRole='owner';
    closeLogin();
    welcomeSection.style.display='none';
    productsSection.style.display='none';
    ownerDashboard.style.display='block';
    businessInfoBtn.style.display='inline-block';
    renderOwnerProductList(); renderUsers();
  } else alert('Invalid ID');
});

userSubmitBtn.addEventListener('click', async ()=>{
  const id = document.getElementById('userIdInput').value;
  const users = await loadUsers();
  if(users[id]){
    currentUserRole='user';
    closeUserLogin();
    welcomeSection.style.display='none';
    productsSection.style.display='none';
    userDashboard.style.display='block';
    businessInfoBtn.style.display='inline-block';
    await renderUserActions(users[id]);
  } else alert('Invalid User ID');
});

businessInfoBtn.addEventListener('click', ()=>{
  businessInfoSection.style.display='block';
  if(currentUserRole==='owner') ownerDashboard.style.display='none';
  else if(currentUserRole==='user') userDashboard.style.display='none';
});

infoBackBtn.addEventListener('click', ()=>{
  businessInfoSection.style.display='none';
  if(currentUserRole==='owner') ownerDashboard.style.display='block';
  else if(currentUserRole==='user') userDashboard.style.display='block';
});

// Add Product (Owner)
document.getElementById('addProductBtn').addEventListener('click', async ()=>{
  const title = document.getElementById('ownerProductTitle').value;
  const price = parseFloat(document.getElementById('ownerProductPrice').value);
  const desc = document.getElementById('ownerProductDesc').value;
  const img = document.getElementById('ownerProductImg').value;
  await saveProduct({title,price,desc,img});
  await renderProducts(); await renderOwnerProductList();
});

// Add User
document.getElementById('addUserBtn').addEventListener('click', async ()=>{
  const id = document.getElementById('newUserId').value.trim();
  const perm = document.getElementById('newUserPerm').value;
  if(id && perm){
    await saveUser(id,perm);
    document.getElementById('newUserId').value=''; document.getElementById('newUserPerm').value='add';
    await renderUsers();
  }
});

// Remove User
document.getElementById('removeUserBtn').addEventListener('click', async ()=>{
  const id = document.getElementById('removeUserId').value.trim();
  if(!id) return alert('Enter User ID');
  await removeUser(id);
  document.getElementById('removeUserId').value='';
  await renderUsers();
});

ownerLogoutBtn.addEventListener('click', logout);
userLogoutBtn.addEventListener('click', logout);

// --- INITIAL LOAD ---
renderProducts();
</script>

</body>
</html>
